<%= render "signed" %>

<div class="container mt-5">
  <h1 class="text-center mb-4">Fazer Empréstimo</h1>

  <!-- Mensagens de flash -->
  <% if flash[:alert] %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <%= flash[:alert] %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <% if flash[:notice] %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= flash[:notice] %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <div class="card shadow p-4">
    <%= form_with(model: [@book, @loan], local: true) do |form| %>
      
      <% if @loan.errors.any? %>
        <div class="alert alert-danger">
          <h4><%= pluralize(@loan.errors.count, "erro") %> impedem o empréstimo de ser salvo:</h4>
          <ul>
            <% @loan.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%= form.hidden_field :book_id, value: @book.id %>
      <%= form.hidden_field :user_id, value: current_user.id %>

      <div class="mb-3">
        <%= form.label :data_emprestimo, "Data de Empréstimo", class: "form-label" %>
        <%= form.date_field :data_emprestimo, class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= form.label :data_devolucao_prevista, "Data Prevista de Devolução", class: "form-label" %>
        <%= form.date_field :data_devolucao_prevista, class: "form-control" %>
      </div>

      <div class="d-flex justify-content-between">
        <%= form.submit "Confirmar Empréstimo", class: "btn btn-primary" %>
        <%= link_to "Meus Empréstimos", book_loans_path(@book), class: "btn btn-secondary" %>
      </div>
    <% end %>
  </div>
</div>
